# A makefile for building Google Test and using it in unit testing the PolySim
# project. Relies on object files generated by primary project makefile.
#
# 	make [all]	- makes everything.
# 	make TARGET - makes the given target.
# 	make clean	- removes all files generated by make.

CC = g++
CFLAGS = -g -Wall -Wextra -Wno-missing-field-initializers -std=c++0x
INCS = -isystem $(GTEST_DIR)/include -I $(GTEST_DIR) -I ../src
LIBS =
OUT = ../bin/test.exe
SHELL = /bin/bash

GTEST_DIR = ../lib/gtest-1.7.0
GTEST_HEADERS = $(GTEST_DIR)/include/gtest/*.h \
								$(GTEST_DIR)/include/gtest/internal/*.h
GTEST_SRCS = $(GTEST_DIR)/src/*.cc $(GTEST_DIR)/src/*.h

TESTS =  util/vector3d_test.o util/ivector3d_test.o util/random_test.o
TESTS += base/box_test.o base/particle_test.o base/bond_test.o
OBJS =  ../obj/util/vector3d.o ../obj/util/ivector3d.o ../obj/util/random.o 
OBJS += ../obj/base/box.o ../obj/base/particle.o ../obj/base/bond.o

.PHONY: clean


all : gtest_main.a $(TESTS) $(OBJS)
	$(CC) $(CFLAGS) $(INCS) -lpthread $^ -o $(OUT)

$(TESTS) : %.o : %.cpp $(GTEST_HEADERS)
	$(CC) $(CFLAGS) $(INCS) -c $< -o $@

$(OBJS) : ../obj/%.o : ../src/%.cpp
	make -C .. all

gtest-all.o : $(GTEST_SRCS) $(GTEST_HEADERS)
	$(CC) $(CFLAGS) $(INCS) -c $(GTEST_DIR)/src/gtest-all.cc

gtest_main.o : $(GTEST_SRCS) $(GTEST_HEADERS)
	$(CC) $(CFLAGS) $(INCS) -c $(GTEST_DIR)/src/gtest_main.cc

gtest.a : gtest-all.o
	$(AR) $(ARFLAGS) $@ $^

gtest_main.a : gtest-all.o gtest_main.o
	$(AR) $(ARFLAGS) $@ $^

clean :
	rm -f gtest.a gtest_main.a *.o */*.o $(OUT)


#$(TESTS) : %.o : %.cpp $(GTEST_HEADERS)
